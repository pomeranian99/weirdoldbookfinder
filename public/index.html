<!DOCTYPE html "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>Google Books Embedded Viewer API Example</title>
    <script
      type="text/javascript"
      src="https://www.google.com/books/jsapi.js"
    ></script>
  </head>

  <body>
    <div class="row">
      <h1>Weird Old Book Finder</h1>
    </div>
    <div class="row">
      <input type="text" id="searchText" />
      <button type="button" id="searchButton">Search</button>
    </div>
    <div class="row">
      <div id="viewerCanvas" style="width: 700px; height: 800px"></div>
      <div id="viewer"></div>
    </div>
  </body>

  <!-- send in the clowns, sorry i mean the javascript -->
  <script defer>
    // create an instance of the google books viewer
    google.books.load();

    const buttonPushed = document.querySelector("#searchButton");

    function initialize() {
      var viewer = new google.books.DefaultViewer(
        document.getElementById("viewerCanvas")
      );
      viewer.load("xyYoAAAAYAAJ");
    }

    google.books.setOnLoadCallback(initialize);

    buttonPushed.addEventListener("click", function (e) {
      const searchValue = document.querySelector("#searchText").value;
      document.getElementById("searchText").value = "";
      let searchTerm = searchValue.replace(/ /g, "+");
      runSearch(searchTerm);
    });

    function runSearch(searchTerm) {
      console.log("yeah bruh the term I got was " + searchTerm);
      let url =
        "https://weird-old-book-finder.glitch.me/bookMe?words=" + searchTerm;
      console.log("I'm gonna send the url query ... " + url);

      fetch(url)
        .then(function (response) {
          return response.text();
        })
        .then(function (text) {
          console.log(text);
          var viewer = new google.books.DefaultViewer(
            document.getElementById("viewerCanvas")
          );
          viewer.load(text);
        });
    }
  </script>
</html>
